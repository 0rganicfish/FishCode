<!DOCTYPE html>
<html>

<head>
    <meta charset='UTF-8'>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
    <script async src='fish.js'></script>
    <link rel='stylesheet' href='Template.css'>
    <link rel='icon' href='img/waiting.svg'>
    <style>
        div {
            margin: 10px;
        }

        span {
            cursor: pointer;
        }

        .app {
            display: flex;
            flex-direction: column;
        }
    </style>
    <title>堆......</title>
</head>

<body>
    <div class="app">
        <div>
            <span id="ajax_btn"><b>点击获得请求</b> txt: </span>
            <span id="ans"></span>
            <script>
                set_ans = res => {
                    ans.innerHTML = res;
                }

                ajax_btn.addEventListener('click', () => {
                    let ajax = new Ajax();
                    ajax.main({
                        url: 'fish.txt',
                        success: res => { set_ans(res) },
                        fail: err => {
                            throw err;
                        }
                    });
                });
            </script>
        </div>

        <div>
            <span id="btn"><b>点击获得请求</b> JSON: </span>
            <span id="ans1"></span>
            <script>
                let ans_obj = {
                    set_ans: res => {
                        let jsons = JSON.parse(res);
                        ans1.innerHTML = "name: " + jsons.data.name +
                            ", age: " + jsons.data.age;
                    },
                    URL: "fish.json",
                    handleEvent: function () {
                        let ajax = new Ajax();
                        ajax.main({
                            url: this.URL,
                            success: res => { this.set_ans(res) }
                        })
                    }
                }

                btn.addEventListener("click", ans_obj)
            </script>
        </div>
        <div>
            <span id="hid" data-ables-id="hid_ans"><b>点击切换</b></span>
            <span id="hid_ans" hidden>mie!</span>
            <script>
                hid.addEventListener("click", (e) => {
                    let id = e.target.closest("span").dataset.ablesId;
                    if (!id) return;

                    let elem = document.getElementById(id);
                    elem.hidden = !elem.hidden;
                }, false)
            </script>
        </div>

        <div>
            <div>
                <b>键盘事件：</b>
                <label for="kinput">
                    <input type="text" placeholder="按下键盘~" id="kinput">
                </label>
                <input type="button" id="clear" value="清除">
            </div>
            <label for="area"><textarea id="area" readonly></textarea></label>
            <style>
                #kinput {
                    width: 190px;
                }

                #area {
                    margin: 6px;
                    width: 300px;
                    height: 200px;
                    resize: none;
                    font-size: smaller;
                }
            </style>
            <script>
                area.value = kinput.value = "";
                kinput.onkeydown = kinput.onkeyup = kinput.onkeypress = handle;
                let lastTime = Date.now();

                function handle(e) {
                    if (area.value && Date.now() - lastTime > 250)
                        area.value += new Array(20).join('-') + '\n';
                    lastTime = Date.now();

                    let text = e.type + ' key=' + e.key + "\n";
                    if (!e.repeat)
                        area.value += text;
                }

                clear.addEventListener("click", () => {
                    area.value = kinput.value = "";
                })
            </script>
        </div>

        <div>
            <span><b>滚动坐标：</b></span>
            <span id="showScroll">0px</span>
            <script>
                window.addEventListener('scroll', () => {
                    showScroll.innerHTML = window.pageYOffset + 'px';
                });
            </script>
        </div>

        <div>
            <div>拖动阻止了 ↓</div>
            <img src="img/waiting.svg">
            <script>
                var img = document.querySelector("img");
                img.addEventListener("mousedown", mouseHandler);
                function mouseHandler(e) {
                    e.preventDefault();
                }
            </script>
        </div>

        <div>
            <input type="text" id="input"> oninput: <span id="result"></span>
            <script>
                input.oninput = function () {
                    result.innerHTML = input.value;
                };

            </script>
        </div>

        <div>
            <form id="noform">
                <label>
                    <span>提交禁止：</span>
                    <input type="text">
                    <input type="submit">
                </label>
            </form>
            <script>
                noform.onsubmit = () => { return false; }
            </script>
        </div>

        <div>
            <span><b>时间~ </b><span id="mie"></span></span>
            <script>
                class Clock {
                    constructor({ template }) {
                        this.template = template;
                    }
                    render() {
                        let date = new Date();

                        let hours = date.getHours();
                        if (hours < 10) hours = '0' + hours;
                        let mins = date.getMinutes();
                        if (mins < 10) mins = '0' + mins;
                        let secs = date.getSeconds() + 1;
                        if (secs < 10) secs = '0' + secs;

                        let output = this.template
                            .replace('h', hours)
                            .replace('m', mins)
                            .replace('s', secs);
                        document.getElementById("mie").innerHTML = output
                    }
                    stop() {
                        clearInterval(this.timer);
                    }
                    start() {
                        this.render();
                        setInterval(() => this.render(), 1000);
                    }
                }

                let clock = new Clock({ template: 'h : m : s' });
                clock.start();
            </script>
        </div>

        <div>
            <span>
                <span id="reset">重置</span>
                <span> | </span>
                <span id="cnt">计数：</span>
                <span id="progress">0</span>
            </span>
            <script>
                let i = 0;
                count = () => {
                    do {
                        progress.innerHTML = i++ / 10;
                    } while (i % 1);
                    if (i <= 1e3)
                        setTimeout(count);

                }
                cnt.onclick = count;
                reset.onclick = () => { i = 0, progress.innerHTML = "0" }
            </script>
        </div>

        <div>
            <script>
                const toggleElements = document.querySelectorAll('div');
                toggleElements.forEach(el => {
                    el.addEventListener('click', function () {
                        this.classList.toggle('active');
                    });
                });
            </script>
            <script>
                const on = (el, evt, fn, opts = {}) => {
                    const delegatorFn = e =>
                        e.target.matches(opts.target) && fn.call(e.target, e)
                    el.addEventListener(
                        evt,
                        opts.target ? delegatorFn : fn,
                        opts.options || false
                    );
                    if (opts.target) return delegatorFn;
                };

                const fn = () => console.log("mie!");
                on(document.body, 'click', fn, { target: "img" });
                // logs '!' upon clicking a `img` element child of the body
            </script>
        </div>

        <div>
            <span id="copy">点击复制</span>
            <script>
                Copy = (copyString) => {
                    let textArea = document.createElement('textarea');
                    textArea.value = copyString;
                    copy.appendChild(textArea);
                    textArea.focus(), textArea.select();
                    document.execCommand('copy');
                    textArea.style.visibility = 'hidden';
                    copy.removeChild(textArea);
                }

                copy.addEventListener("click", () => {
                    Copy("mie")
                })


            </script>

        </div>
    </div>

</body>

</html>